<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Laudo</title>

  <style>
    :root{
      --blue1:#0d3a66;
      --blue2:#06243f;
      --panel:#ffffff;
      --muted:#4b667d;
      --border:#d8e6f3;
      --shadow: 0 16px 45px rgba(0,0,0,.12);
    }

    *{ box-sizing:border-box; }

    body{
      margin:0;
      font-family: Arial, sans-serif;
      background: linear-gradient(120deg, #eef7ff, #f5fbff);
      padding: 18px;
    }

    .page{
      width: min(1100px, 96vw);
      margin: 0 auto;
      background: var(--panel);
      border: 1px solid var(--border);
      border-radius: 18px;
      box-shadow: var(--shadow);
      overflow:hidden;
    }

    header{
      padding: 16px 18px;
      border-bottom: 1px solid var(--border);
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      flex-wrap:wrap;
      background: linear-gradient(90deg, rgba(13,58,102,.06), rgba(6,36,63,.03));
    }

    .title{
      font-weight: 900;
      color: var(--blue2);
      font-size: 20px;
      letter-spacing: .4px;
    }

    .actions{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
    }

    .btn{
      border:none;
      cursor:pointer;
      border-radius: 999px;
      padding: 10px 14px;
      font-weight: 900;
      letter-spacing: .2px;
      color:#fff;
      background: linear-gradient(90deg, var(--blue1), var(--blue2));
      box-shadow: 0 10px 25px rgba(6,36,63,.15);
    }
    .btn.gray{
      background: linear-gradient(90deg, #607d8b, #455a64);
    }

    .content{
      padding: 18px;
      display:grid;
      gap:14px;
    }

    .grid{
      display:grid;
      grid-template-columns: 1fr 260px;
      gap:14px;
    }
    @media(max-width:900px){
      .grid{ grid-template-columns: 1fr; }
    }

    label{
      font-weight: 900;
      color: var(--blue2);
      margin-bottom: 6px;
      display:block;
    }

    input{
      width:100%;
      padding: 12px 12px;
      border-radius: 14px;
      border: 1px solid var(--border);
      outline:none;
      font-size: 15px;
      background:#fff;
    }

    textarea{
      width:100%;
      min-height: 520px;
      resize: vertical;
      border-radius: 14px;
      border: 1px solid var(--border);
      padding: 14px;
      outline:none;
      font-size: 15px;
      line-height:1.4;
      background:#fff;
      font-family: Arial, sans-serif;
    }

    /* ✅ Cabeçalho impresso */
    .printHeader{
      border: 1px solid var(--border);
      border-radius: 14px;
      padding: 12px 14px;
      background: #f8fbff;
      display:flex;
      justify-content:space-between;
      gap:12px;
      flex-wrap:wrap;
    }
    .printHeader b{ color: var(--blue2); }
    .printHeader .item{
      font-weight: 800;
      color: #163a57;
    }

    /* ✅ Conteúdo impresso do laudo */
    #printConteudo{
      display:none; /* aparece só no print */
      border: 1px solid var(--border);
      border-radius: 14px;
      padding: 14px;
      background: #fff;
      white-space: pre-wrap;  /* mantém quebras de linha */
      line-height: 1.45;
      font-size: 15px;
      color: #0c2a44;
      min-height: 520px;
    }

    .note{
      color: var(--muted);
      font-weight: 700;
      font-size: 14px;
    }

    /* ===========================
       ✅ IMPRESSÃO
    =========================== */
    @media print{
      body{ background:#fff; padding:0; }
      header{ display:none; }
      .page{ border:none; box-shadow:none; border-radius:0; }

      /* esconde campos de edição no papel */
      .note, .grid, textarea { display:none !important; }

      /* mostra a versão imprimível */
      #printConteudo{ display:block; border:none; padding:0; min-height:auto; }
      .printHeader{ border:none; padding:0 0 10px 0; border-radius:0; }
    }
  </style>
</head>

<body>
  <div class="page">
    <header>
      <div class="title">Laudo — Digitação e Impressão</div>
      <div class="actions">
        <button class="btn gray" id="btnVoltar" type="button">Voltar</button>
        <button class="btn" id="btnImprimir" type="button">Imprimir</button>
      </div>
    </header>

    <div class="content">

      <!-- ✅ Cabeçalho que imprime -->
      <div class="printHeader" id="printHeader">
        <div class="item"><b>Paciente:</b> <span id="printNome">—</span></div>
        <div class="item"><b>Nº Exame:</b> <span id="printExame">—</span></div>
      </div>

      <!-- área editável -->
      <div class="grid">
        <div>
          <label>Nome do Paciente</label>
          <input id="nome" placeholder="Nome do paciente"/>
        </div>
        <div>
          <label>Nº Exame</label>
          <input id="exame" placeholder="000156/2026"/>
        </div>
      </div>

      <div>
        <label>Digitação do Laudo</label>
        <textarea id="conteudo" placeholder="Digite aqui o conteúdo do laudo..."></textarea>
      </div>

      <!-- ✅ Versão imprimível do conteúdo -->
      <div id="printConteudo"></div>

      <div class="note">
        Dica: Tudo que você digitar no laudo será impresso exatamente como aparece.
      </div>

    </div>
  </div>

  <script>
    const $ = (id)=>document.getElementById(id);

    function getQuery(){
      const q = {};
      const params = new URLSearchParams(location.search);
      for(const [k,v] of params.entries()) q[k] = v;
      return q;
    }

    function carregarDados(){
      let dados = null;
      try{
        dados = JSON.parse(localStorage.getItem("SI_DADOS_LAUDO") || "null");
      }catch(e){ dados = null; }

      const q = getQuery();

      const nome  = (q.nome  || (dados && dados.nome)  || "").trim();
      const exame = (q.exame || (dados && dados.exame) || "").trim();

      $("nome").value  = nome;
      $("exame").value = exame;

      // se quiser, pode pré preencher o texto bruto:
      // $("conteudo").value = (dados && dados.textoBruto) ? dados.textoBruto : "";

      syncParaImpressao();
    }

    function syncParaImpressao(){
      $("printNome").textContent  = $("nome").value.trim() || "—";
      $("printExame").textContent = $("exame").value.trim() || "—";

      // ✅ copia o que está no textarea para o bloco imprimível
      const txt = $("conteudo").value || "";
      $("printConteudo").textContent = txt;
    }

    $("nome").addEventListener("input", syncParaImpressao);
    $("exame").addEventListener("input", syncParaImpressao);
    $("conteudo").addEventListener("input", syncParaImpressao);

    $("btnImprimir").addEventListener("click", ()=>{
      syncParaImpressao(); // ✅ garante antes do print
      window.print();
    });

    $("btnVoltar").addEventListener("click", ()=>{
      window.location.href = "index.html";
    });

    carregarDados();
  </script>
</body>
</html>
